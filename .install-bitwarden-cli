#!/bin/sh -eu

! command -v bw >/dev/null || exit 0

[ "$(uname -s)" = Darwin ] || {
	echo "unsupported OS" >&2
	exit 1
}

command -v brew >/dev/null || {
	curl -fsSL https://github.com/Homebrew/install/raw/HEAD/install.sh | bash
	eval "$(/opt/homebrew/bin/brew shellenv)"
}

command -v bw >/dev/null || {
	brew install bitwarden-cli

	cat <<EOF

Now unlock the Bitwarden vault before installing the dotfiles:

     $ bw login \$BW_EMAIL
     $ export BW_SESSION=\$(bw unlock --raw)
     $ chezmoi apply

EOF
}
