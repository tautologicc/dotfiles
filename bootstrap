#!/bin/sh -eu

# TODO(ttlgcc): Port to Linux.

export HOMEBREW_NO_ANALYTICS=1

bash -c "$(curl -fsSL https://github.com/Homebrew/install/raw/HEAD/install.sh)"
eval "$(/opt/homebrew/bin/brew shellenv)"
brew analytics off

brew install --quiet age chezmoi pinentry-mac rbw

printf 'bitwarden email? '
read bw_email
rbw config set email "$bw_email"
rbw config set pinentry pinentry-mac
rbw register
rbw login

chezmoi init --apply https://github.com/tautologicc/dotfiles
chezmoi git remote set-url origin git@github.com:tautologicc/dotfiles

yesno 'reboot now' && sudo reboot || :
