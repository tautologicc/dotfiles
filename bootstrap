#!/bin/sh -eu

# TODO(ttlgcc): Port to Linux.

export HOMEBREW_NO_ANALYTICS=1
bash -c "$(curl -fsSL https://github.com/Homebrew/install/raw/HEAD/install.sh)"
eval "$(/opt/homebrew/bin/brew shellenv)"
brew analytics off

brew install --quiet age chezmoi rbw

printf 'bitwarden email? '
head -n1 | xargs -- rbw config set email
rbw register
rbw login

chezmoi init --apply https://github.com/tautologicc/dotfiles
chezmoi git remote set-url origin git@github.com:tautologicc/dotfiles

yesno 'reboot now' && sudo reboot || :
